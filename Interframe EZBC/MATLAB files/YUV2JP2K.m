clear all;
clc;

fp = fopen('BUS_352x288_30_all_out_jp2k_01.yuv','rb');

%mv_bytes = [9822 9940 10274 9675 6304 7814 9016 9263 9308];

num_frames = 144;
width = 352;
height = 288;
GOPsz = 32;
GOPnum = (num_frames) / GOPsz;

frame_rate = 30;

GOPres = num_frames - GOPsz * floor(GOPnum);

GOPnum = floor(GOPnum);

if GOPnum < 1
    GOPnum = 1;
    GOPsz = num_frames;
end

% bitrate = 1300;
% 
% total_rate = 1000/8 * bitrate;

%GOP_budget = total_rate * num_frames / 30;

y_size = width*height;
c_size = y_size / 4;
f_size = y_size + 2*c_size;
M = fread(fp,f_size*num_frames,'float32');
fclose(fp);

coef = sqrt(3/2);
scene_3 = 0.8686;

% M is a column vector with the y,u,v components stacked
% Next, extract the y, u and v frames into separate files

y = zeros(y_size*num_frames,1);
u = zeros(c_size*num_frames,1);
v = zeros(c_size*num_frames,1);

y_count = 0;
u_count = 0;
v_count = 0;

for f=1:num_frames
      y_start = (f-1)*y_size + 1;
      c_start = (f-1)*c_size + 1;
      f_start = (f-1)*f_size + 1;
      y(y_start:y_start+y_size-1) = M(f_start:f_start+y_size-1);
      u(c_start:c_start+c_size-1) = M(f_start+y_size:f_start+y_size+c_size-1);
      v(c_start:c_start+c_size-1) = M(f_start+y_size+c_size:f_start+y_size+2*c_size-1);

% if f == 1 || f == 33  
%     u(c_start:c_start+c_size-1) = u(c_start:c_start+c_size-1) - 128;
%     v(c_start:c_start+c_size-1) = v(c_start:c_start+c_size-1) - 128;
% end
  
%   if f == 1
%     y_out = y(y_start:y_start+y_size-1);
%     u_out = u(c_start:c_start+c_size-1);
%     v_out = v(c_start:c_start+c_size-1);
%     
%     y_out = y_out/coef/coef/coef/scene_3;
%     u_out = u_out/coef/coef/coef/scene_3;
%     v_out = v_out/coef/coef/coef/scene_3;
%     
%     y_out_orig = y_out;
%     u_out_orig = u_out;
%     v_out_orig = v_out;
%     
% %Y
%     for n = 1 : length(y_out)
%       if y_out(n)>255
%           y_out(n) = 255;
%           y_count = y_count + 1;
%       elseif y_out(n)<0
%           y_out(n) = 0;
%           y_count = y_count + 1;
%       end
%     end
% %U
%       for n = 1 : length(u_out)
%         if u_out(n)>255
%             u_out(n) = 255;
%             u_count = u_count + 1;
%         elseif u_out(n)<0
%             u_out(n) = 0;
%             u_count = u_count + 1;
%         end
%       end
% %V
%       for n = 1 : length(v_out)
%         if v_out(n)>255
%             v_out(n) = 255;
%             v_count = v_count + 1;
%         elseif v_out(n)<0
%             v_out(n) = 0;
%             v_count = v_count + 1;
%         end
%       end
% 
%       fwrite(out_fp,y_out,'uint8');
%       fwrite(out_fp,u_out,'uint8');
%       fwrite(out_fp,v_out,'uint8');
%   end
  
end

clear M;

y0 = (y)*16;
u0 = (u)*16;
v0 = (v)*16;

clear y;
clear u;
clear v;

%248076 - 1000
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% fp = fopen('bus_t_y.rawl','wb');
% fwrite(fp,y0,'int16');
% fclose(fp);
% 
% fp = fopen('bus_t_u.rawl','wb');
% fwrite(fp,u0,'int16');
% fclose(fp);
% 
% fp = fopen('bus_t_v.rawl','wb');
% fwrite(fp,v0,'int16');
% fclose(fp);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

begin = 0;

% y1 = reshape(y(begin*y_size+1:(begin+1)*y_size),width,height);
% u1 = reshape(u(begin*c_size+1:(begin+1)*c_size),width/2,height/2);
% v1 = reshape(v(begin*c_size+1:(begin+1)*c_size),width/2,height/2);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Finish by writing the frames out

% for i = 0:(GOPnum-1)
%     
% begin = i;
% 
% y2 = y0(begin*GOPsz*y_size+1:(begin+1)*GOPsz*y_size);
% u2 = u0(begin*GOPsz*c_size+1:(begin+1)*GOPsz*c_size);
% v2 = v0(begin*GOPsz*c_size+1:(begin+1)*GOPsz*c_size);
% 
% y2 = round(y2);
% u2 = round(u2);
% v2 = round(v2);
% 
% % Finish by writing the frames out
% 
% y_name = ['ter_t1_y' num2str(i) '.rawl' ];
% 
% fp = fopen(y_name,'wb');
% fwrite(fp,y2,'int16');
% fclose(fp);
% 
% u_name = ['ter_t1_u' num2str(i) '.rawl' ];
% 
% fp = fopen(u_name,'wb');
% fwrite(fp,u2,'int16');
% fclose(fp);
% 
% v_name = ['ter_t1_v' num2str(i) '.rawl' ];
% 
% fp = fopen(v_name,'wb');
% fwrite(fp,v2,'int16');
% fclose(fp);
% 
% % total_name = ['tmp_t' num2str(i) '.rawl' ];
% % 
% % fp = fopen(total_name,'wb');
% % for j = 0:(GOPsz-1)
% %      fwrite(fp,y2(j*y_size+1 : j*y_size+y_size),'int16');
% %      fwrite(fp,u2(j*c_size+1 : j*c_size+c_size),'int16');
% %      fwrite(fp,v2(j*c_size+1 : j*c_size+c_size),'int16');
% % end
% % fclose(fp);
% 
% end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% GOPnum = 1;
% GOPsz = 144;
% GOPres = 0;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
for i = 0:(GOPnum-1)
    
begin = i;

y2 = y0(begin*GOPsz*y_size+1:(begin+1)*GOPsz*y_size);
u2 = u0(begin*GOPsz*c_size+1:(begin+1)*GOPsz*c_size);
v2 = v0(begin*GOPsz*c_size+1:(begin+1)*GOPsz*c_size);

y2 = round(y2);
u2 = round(u2);
v2 = round(v2);

% Finish by writing the frames out

y_name = ['bq_t1_y' num2str(i) '.rawl' ];

fp = fopen(y_name,'wb');
fwrite(fp,y2,'int16');
fclose(fp);

u_name = ['bq_t1_u' num2str(i) '.rawl' ];

fp = fopen(u_name,'wb');
fwrite(fp,u2,'int16');
fclose(fp);

v_name = ['bq_t1_v' num2str(i) '.rawl' ];

fp = fopen(v_name,'wb');
fwrite(fp,v2,'int16');
fclose(fp);

end

if GOPres ~= 0
    begin = GOPnum;

    y2 = y0(begin*GOPsz*y_size+1:(begin*GOPsz+GOPres)*y_size);
    u2 = u0(begin*GOPsz*c_size+1:(begin*GOPsz+GOPres)*c_size);
    v2 = v0(begin*GOPsz*c_size+1:(begin*GOPsz+GOPres)*c_size);

    y2 = round(y2);
    u2 = round(u2);
    v2 = round(v2);

    % Finish by writing the frames out

    y_name = ('bq_t1_y_res.rawl');

    fp = fopen(y_name,'wb');
    fwrite(fp,y2,'int16');
    fclose(fp);

    u_name = ('bq_t1_u_res.rawl');

    fp = fopen(u_name,'wb');
    fwrite(fp,u2,'int16');
    fclose(fp);

    v_name = ('bq_t1_v_res.rawl');

    fp = fopen(v_name,'wb');
    fwrite(fp,v2,'int16');
    fclose(fp);
end


% sub_rate = 41474;  
%                    
% 
% rate_str = num2str(sub_rate);

%Bus
% -slope 40900,40960,41013,41038,41060,41096,41213,41279,41358,41495,41564

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
for i = 0:(GOPnum-1)
    y_name = ['bq_t1_y' num2str(i) '.rawl' ];
    u_name = ['bq_t1_u' num2str(i) '.rawl' ];
    v_name = ['bq_t1_v' num2str(i) '.rawl' ];
    
%     total_name = ['tmp_t' num2str(i) '.rawl' ];
    out_name = ['tmp_bq' num2str(i) '.j2c'];

    
%    system([' kdu_compress ' ' -i ' y_name '*16@4147200,' u_name '*16@1036800,' v_name '*16@1036800 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' "Sdims={1080,1920},{1080,1920},{1080,1920},{1080,1920},{540,960}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=2 Clevels:C0=5 Clevels:C4=5 Clevels:C8=5 ' ' -rate ' rate_str]);
                                                                                                                                                                                                                                                                                                                %  41500,41624,41668,41704,41755,41811,41863,41908,41970,42062,42125,42230,42400,42600
%    system([' kdu_compress ' ' -i ' y_name '*16@4147200,' u_name '*16@1036800,' v_name '*16@1036800 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep:C0=0.0001 Qstep:C16=0.0001 Qstep:C32=0.0001 ' ' "Sdims={1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{540,960}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=5 Clevels:C16=5 Clevels:C32=5 ' ' -slope 41908 ' ]);41050,41152,41260,

%    system([' kdu_compress ' ' -i ' y_name '*32@4147200,' u_name '*32@1036800,' v_name '*32@1036800 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep=0.0001 Qstep:C0=0.0001 Qstep:C32=0.0001 Qstep:C64=0.0001 ' ' "Sdims={1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{540,960}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=6 Clevels:C32=6 Clevels:C64=6 '  ' -slope 40825  ' ]);%40980,41050,41152,41260,41342,41420,41500,41582,41660,41842,41970
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
%    system([' kdu_compress ' ' -i ' y_name '*32@1843200,' u_name '*32@460800,' v_name '*32@460800 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep=0.0001 Qstep:C0=0.0001 Qstep:C32=0.0001 Qstep:C64=0.0001 ' ' "Sdims={720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{360,640}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=6 Clevels:C32=6 Clevels:C64=6 '  ' -slope 41500  ' ]);%41600,41750,41900,41950,42000,42110,42230,42350,42460,42560,42670


%    -slope 41816,42144,42254,42364,42474
%    system([' kdu_compress ' ' -i ' y_name '*16@202752,' u_name '*16@50688,' v_name '*16@50688 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep:C0=0.0003 Qstep:C16=0.0003 Qstep:C32=0.0003 ' ' "Sdims={288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{144,176}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=5 Clevels:C16=5 '  ' -slope 40000,41800,42100,42300,42500 ' ]);
%    system([' kdu_compress ' ' -i ' y_name '*16@202752,' u_name '*16@50688,' v_name '*16@50688 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep:C0=0.0003 Qstep:C16=0.0003 Qstep:C32=0.0003 ' ' "Sdims={288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{144,176}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=5 Clevels:C16=5 '  ' -rate 7,5.8,5,4.2,3.7 ' ]);
%    system([' kdu_compress ' ' -i ' y_name '*96@202752,' u_name '*96@50688,' v_name '*96@50688 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep:C0=0.0003 Qstep:C1=0.0003 Qstep:C2=0.0003 Qstep:C3=0.0003 Qstep:C4=0.0003 Qstep:C5=0.0003 Qstep:C96=0.0003 Qstep:C97=0.0003 Qstep:C98=0.0003 Qstep:C99=0.0003 Qstep:C100=0.0003 Qstep:C101=0.0003 Qstep:C192=0.0003 Qstep:C193=0.0003 Qstep:C194=0.0003 Qstep:C195=0.0003 Qstep:C196=0.0003 Qstep:C197=0.0003 ' ' Ssize={288,704} "Sdims={288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{144,176}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=5 Clevels:C1=5 Clevels:C2=5 Clevels:C3=5 Clevels:C4=5 Clevels:C5=5 Clevels:C96=5 Clevels:C97=5 Clevels:C98=5 Clevels:C99=5 Clevels:C100=5 Clevels:C101=5 Clevels:C192=5 Clevels:C193=5 Clevels:C194=5 Clevels:C195=5 Clevels:C196=5 Clevels:C197=5 '  ' -slope 41200,41711,41742,41773,41825,41894,41977,42014,42160,42210,42270 ' ]);
%    system([' kdu_compress ' ' -i ' y_name '*64@202752,' u_name    '*64@50688,' v_name '*64@50688 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep=0.001 Qstep:C0=0.0003 Qstep:C32=0.0003  ' ' "Sdims={288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{144,176}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=6 Clevels:C32=6 Clevels:C64=5 Clevels:C96=5 Clevels:C128=5 Clevels:C160=5 '  ' -slope 41471,41900,42200,42300 ' ]);
%   Qstep:C96=0.0003 Qstep:C112=0.0003 Qstep:C128=0.0003 Qstep:C144=0.0003 Qstep:C160=0.0003 Qstep:C176=0.0003 Qstep:C192=0.0003 Qstep:C208=0.0003 Qstep:C224=0.0003 Qstep:C240=0.0003 Qstep:C256=0.0003 Qstep:C272=0.0003    
%    system([' kdu_compress ' ' -i ' y_name '*96@202752,' u_name '*96@50688,' v_name '*96@50688 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep=0.001 Qstep:C0=0.0003 Qstep:C32=0.0003 Qstep:C64=0.0003 ' ' "Sdims={288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{144,176}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=6 Clevels:C32=6 Clevels:C64=6 Clevels:C96=5 Clevels:C128=5 Clevels:C160=5 Clevels:C192=5 Clevels:C224=5 Clevels:C256=5 '  ' -slope 41372,42170,42280,42390,42400 ' ]);

%   system([' kdu_compress ' ' -i ' total_name '*96@304128,' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep:C0=0.0003 Qstep:C16=0.0003 Qstep:C32=0.0003 Qstep:C48=0.0003 Qstep:C64=0.0003 Qstep:C80=0.0003 ' ' "Sdims={432,352}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=5 Clevels:C16=5 Clevels:C32=5 Clevels:C48=5 Clevels:C64=5 Clevels:C80=5  '  ' -slope 41987 ' ]);

%    system([' kdu_compress ' ' -i ' y_name '*144@202752,' u_name '*144@50688,' v_name '*144@50688 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep=0.0005 Qstep:C0=0.0001 Qstep:C32=0.0001 Qstep:C64=0.0001 Qstep:C96=0.0001 Qstep:C128=0.0001 Qstep:C160=0.0001 Qstep:C192=0.0001 Qstep:C224=0.0001 Qstep:C256=0.0001 Qstep:C288=0.0001 Qstep:C320=0.0001 Qstep:C352=0.0001 Qstep:C384=0.0001 Qstep:C400=0.0001 Qstep:C416=0.0001 ' ' "Sdims={288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{144,176}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=6 Clevels:C32=6 Clevels:C64=6 Clevels:C96=6 Clevels:C128=6 Clevels:C160=6 Clevels:C192=6 Clevels:C224=6 Clevels:C256=6 Clevels:C288=6 Clevels:C320=6 Clevels:C352=6 Clevels:C384=5 Clevels:C400=5 Clevels:C416=5 '  ' -slope 40900,40960,41013,41038,41060,41096,41213,41279,41358,41495,41564  ' ]);

%    system([' kdu_compress ' ' -i ' y_name '*240@202752,' u_name '*240@50688,' v_name '*240@50688 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep=0.0005 Qstep:C0=0.0001 Qstep:C32=0.0001 Qstep:C64=0.0001 Qstep:C96=0.0001 Qstep:C128=0.0001 Qstep:C160=0.0001 Qstep:C192=0.0001 Qstep:C224=0.0001 Qstep:C256=0.0001 Qstep:C288=0.0001 Qstep:C320=0.0001 Qstep:C352=0.0001 Qstep:C384=0.0001 Qstep:C416=0.0001 Qstep:C448=0.0001 Qstep:C480=0.0001 Qstep:C512=0.0001 Qstep:C544=0.0001 Qstep:C576=0.0001 Qstep:C608=0.0001 Qstep:C640=0.0001 Qstep:C656=0.0001 Qstep:C672=0.0001 Qstep:C688=0.0001 ' ' "Sdims={288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{144,176}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=6 Clevels:C32=6 Clevels:C64=6 Clevels:C96=6 Clevels:C128=6 Clevels:C160=6 Clevels:C192=6 Clevels:C224=6 Clevels:C256=6 Clevels:C288=6 Clevels:C320=6 Clevels:C352=6 Clevels:C384=6 Clevels:C416=6 Clevels:C448=6 Clevels:C480=6 Clevels:C512=6 Clevels:C544=6 Clevels:C576=6 Clevels:C608=6 Clevels:C640=6 Clevels:C656=5 Clevels:C672=5 Clevels:C688=5 '  ' -slope 42000  ' ]);

    system([' kdu_compress ' ' -i ' y_name '*32@202752,' u_name '*32@50688,' v_name '*32@50688 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep=0.0005 Qstep:C0=0.00005 Qstep:C32=0.00005 Qstep:C64=0.00005 ' ' "Sdims={288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{144,176}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=6 Clevels:C32=6 Clevels:C64=6 '  ' -slope 41420,41500,41582,41660,41842,41970  ' ]); %41050,41152,41260,41342,
%                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 % 40992,41013,41042,41094,41196,41262,41448,41527,41647,41856       for tempete
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  %  41071,41125,41239,41296,41363,41469,41532,41571,41684          for flower
    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
%     system([' kdu_compress ' ' -i ' y_name '*32@798720,' u_name '*32@199680,' v_name '*32@199680 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep=0.00001 Qstep:C0=0.000001 Qstep:C1=0.000001 Qstep:C2=0.000001 Qstep:C3=0.000001 Qstep:C4=0.000001 Qstep:C5=0.000001 Qstep:C6=0.000001 Qstep:C7=0.000001 Qstep:C8=0.000001 Qstep:C9=0.000001 Qstep:C10=0.000001 Qstep:C11=0.000001 Qstep:C12=0.000001 Qstep:C13=0.000001 Qstep:C14=0.000001 Qstep:C15=0.000001 Qstep:C16=0.000001 Qstep:C17=0.000001 Qstep:C18=0.000001 Qstep:C19=0.000001 Qstep:C20=0.000001 Qstep:C21=0.000001 Qstep:C22=0.000001 Qstep:C23=0.000001 Qstep:C24=0.000001 Qstep:C25=0.000001 Qstep:C26=0.000001 Qstep:C27=0.000001 Qstep:C28=0.000001 Qstep:C29=0.000001 Qstep:C30=0.000001 Qstep:C31=0.000001 ' ' "Sdims={480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{480,832},{240,416}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=6 Clevels:C1=3 Clevels:C32=5 Clevels:C64=5 '  ' -slope 41288,41551,41750,42087,42797  ' ]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        %  41236,41280,41395,41524,41663,41834,42063,42457       %  41288,41422,41551,41686,41817,41980,42087,42256,42505,42797
%    system([' kdu_compress ' ' -i ' y_name '*32@691200,' u_name '*32@172800,' v_name '*32@172800 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep=0.00001 Qstep:C0=0.00001 Qstep:C1=0.00001 Qstep:C2=0.00001 Qstep:C3=0.00001 Qstep:C32=0.001 Qstep:C33=0.001 Qstep:C34=0.001 Qstep:C35=0.001 Qstep:C64=0.001 Qstep:C65=0.001 Qstep:C66=0.001 Qstep:C67=0.001 ' ' "Sdims={480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{480,720},{240,360}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=5 Clevels:C1=3 Clevels:C2=3 Clevels:C3=3 Clevels:C4=1 Clevels:C5=1 Clevels:C6=1 Clevels:C7=1 Clevels:C32=5 Clevels:C33=1 Clevels:C64=5 Clevels:C65=1 '  ' -slope 41441 ' ]);
end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   %  41415,41481,41559,41607,41662,41778,41875

if GOPres ~= 0
    y_name = ('bq_t1_y_res.rawl');
    u_name = ('bq_t1_u_res.rawl');
    v_name = ('bq_t1_v_res.rawl');
    %,41220,41275,41346,41483,41559,41650
    %,41056,41275,41346,41483,41559
    out_name = ('tmp_bq_res.j2c');
    
    system([' kdu_compress ' ' -i ' y_name '*16@202752,' u_name '*16@50688,' v_name '*16@50688 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep=0.0005 Qstep:C0=0.00005 Qstep:C16=0.00005 Qstep:C32=0.00005 ' ' "Sdims={288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{288,352},{144,176}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=5 Clevels:C16=5 Clevels:C32=5 '   ' -slope 41420,41500,41582,41660,41842,41970   ' ]); %41050,41152,41260,41342,
%  41500,41624,41668,41704,41755,41811,41863,41908,41970,42062,42125,42230,42400,42600
%                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       %41050,41152,41260,41342,41420,41500,41582,41660,41842,41970

%    system([' kdu_compress ' ' -i ' y_name '*16@4147200,' u_name '*16@1036800,' v_name '*16@1036800 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep:C0=0.0001 Qstep:C16=0.0001 Qstep:C32=0.0001 ' ' "Sdims={1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{1080,1920},{540,960}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=5 Clevels:C16=5 Clevels:C32=5 ' ' -slope 40825 ' ]);%40980,41050,41152,41260,41342,41420,41500,41582,41660,41842,41970

%    system([' kdu_compress ' ' -i ' y_name '*16@1843200,' u_name '*16@460800,' v_name '*16@460800 ' ' -o ' out_name ' Nprecision=16 ' ' Nsigned=yes ' ' Qstep:C0=0.0001 Qstep:C16=0.0001 Qstep:C32=0.0001 ' ' "Sdims={720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{720,1280},{360,640}" ' ' Cycc=no ' ' -no_weights ' ' Clevels=1 Clevels:C0=5 Clevels:C16=5 Clevels:C32=5 ' ' -slope 41500 ' ]);% 41600,41750,41900,41950,42000,42110,42230,42350,42460,42560,42670
end
